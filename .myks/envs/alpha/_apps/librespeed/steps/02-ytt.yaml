apiVersion: apps/v1
kind: Deployment
metadata:
  name: librespeed
spec:
  selector:
    matchLabels:
      app: librespeed
  template:
    metadata:
      labels:
        app: librespeed
    spec:
      containers:
      - name: librespeed
        image: linuxserver/librespeed:5.3.1
        env:
        - name: PASSWORD
          valueFrom:
            secretKeyRef:
              name: librespeed
              key: password
        ports:
        - containerPort: 80
          name: http
---
apiVersion: v1
kind: Secret
metadata:
  name: librespeed
stringData:
  password: <path:static/0.sops.yaml#password>
---
apiVersion: v1
kind: Service
metadata:
  name: librespeed
spec:
  ports:
  - name: http
    port: 80
    targetPort: http
  selector:
    app: librespeed
---
apiVersion: traefik.io/v1alpha1
kind: IngressRoute
metadata:
  name: librespeed-protected
spec:
  entryPoints:
  - web
  - websecure
  routes:
  - match: Host(`librespeed.zebradil.dev`) || Host(`librespeed.gray.zebradil.dev`) || Host(`librespeed.junior.zebradil.dev`)
    kind: Rule
    middlewares:
    - name: chain-authelia-auth
      namespace: authelia
    services:
    - name: librespeed
      port: http
---
apiVersion: traefik.io/v1alpha1
kind: IngressRoute
metadata:
  name: librespeed-lan
spec:
  entryPoints:
  - lan-web
  - lan-websecure
  routes:
  - match: Host(`librespeed.lan.zebradil.dev`) || Host(`librespeed.gray.lan.zebradil.dev`) || Host(`librespeed.junior.lan.zebradil.dev`)
    kind: Rule
    services:
    - name: librespeed
      port: http
---
apiVersion: traefik.io/v1alpha1
kind: IngressRoute
metadata:
  name: librespeed-vpn
spec:
  entryPoints:
  - vpn-web
  - vpn-websecure
  routes:
  - match: Host(`librespeed.ts.zebradil.dev`) || Host(`librespeed.gray.ts.zebradil.dev`) || Host(`librespeed.junior.ts.zebradil.dev`)
    kind: Rule
    services:
    - name: librespeed
      port: http
