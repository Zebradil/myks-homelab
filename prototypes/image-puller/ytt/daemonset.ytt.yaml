#@ load("@ytt:data", "data")
#@ load("@ytt:regexp", "regexp")

#@ app = data.values.application
#@ name = data.values.myks.context.app
#@ ns = name

#@ matchLabels = {"app": name}

#@ if/end app.enabled and app.images:
---
apiVersion: apps/v1
kind: DaemonSet
metadata:
  name: #@ name
  namespace: #@ ns
spec:
  selector:
    matchLabels: #@ matchLabels
  template:
    metadata:
      labels: #@ matchLabels
    spec:
      restartPolicy: Never
      containers:
        #@ for img in app.images:
        - name: #@ regexp.replace("[^a-zA-Z0-9\-]", img, "-").lower()[0:63]
          image: #@ img
          command: ''
          args: ''
        #@ end
