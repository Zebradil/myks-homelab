#@ load("@ytt:data", "data")

#@ proto_cfg = data.values.prototype

#@ def get_path(source_cfg, source_name):
#@   kind = source_cfg.kind if "kind" in source_cfg else "charts"
#@   return "{}/{}".format(kind, source_name)
#@ end

#@ if/end proto_cfg.sources:
---
apiVersion: vendir.k14s.io/v1alpha1
kind: Config
directories:
  #@ for source in proto_cfg.sources:
  #@   cfg = proto_cfg.sources[source]
  - path: #@ get_path(cfg, source)
    contents:
      - path: .
        lazy: true
        #@ if/end "helmChart" in cfg:
        helmChart:
          name: #@ cfg.helmChart.name or source
          version: #@ cfg.helmChart.version
          repository:
            url: #@ cfg.helmChart.url
        #@ if/end "git" in cfg:
        git:
          url: #@ cfg.git.url
          ref: #@ cfg.git.ref
        #@ if/end "includePaths" in cfg:
        includePaths: #@ cfg.includePaths
        #@ if/end "excludePaths" in cfg:
        excludePaths: #@ cfg.excludePaths
        #@ if/end "newRootPath" in cfg:
        newRootPath: #@ cfg.newRootPath
  #@ end
