#@ load("@ytt:data", "data")
#@ load("secrets.star", "sec")

#@ d = data.values
---
domain: #@ d.environment.host

ingress:
  enabled: true
  subdomain: auth

  traefikCRD:
    enabled: true
    entryPoints:
      - websecure

  tls:
    enabled: false

pod:
  kind: Deployment
  replicas: 1

configMap:
  enabled: true

  authentication_backend:
    ldap:
      enabled: false
    file:
      enabled: true

  session:
    redis:
      enabled: false

  storage:
    local:
      enabled: true
    postgres:
      enabled: false

  notifier:
    smtp:
      enabled: true
      username: #@ sec.sops("smtp", "username")
      #!sender: #@ sec.sops("smtp", "sender")
      sender: #@ "authelia@" + d.environment.host
      host: smtp.gmail.com
      port: 587

  identity_providers:
    oidc:
      enabled: false

secret:
  existingSecret: authelia

#! For the "file" authentication backend.
persistence:
  enabled: true
  #! Minimum size with synology-csi is 1Gi.
  size: 1Gi
