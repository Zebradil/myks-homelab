#@ load("@ytt:data", "data")
---
image:
  tag: #@ data.values.application.version

providers:
  kubernetesCRD:
    allowCrossNamespace: true

hostNetwork: true
deployment:
  dnsPolicy: ClusterFirstWithHostNet

ports:
  traefik:
    host: localhost
  metrics:
    #! When using hostNetwork, use another port to avoid conflict with node exporter:
    #! https://github.com/prometheus/prometheus/wiki/Default-port-allocations
    port: 19100
    host: localhost
  web:
    port: 80
    redirectTo:
      port: websecure
  websecure:
    port: 443

livenessProbe:
  host: localhost

readinessProbe:
  host: localhost

service:
  enabled: false

nodeSelector:
  kubernetes.io/hostname: #@ data.values.application.nodeSelector.hostname

updateStrategy:
  rollingUpdate:
    maxUnavailable: 1

securityContext:
  capabilities:
    drop: [ALL]
    add: [NET_BIND_SERVICE]
  runAsNonRoot: false
  runAsUser: 0

additionalArguments:
  -  #@ "--providers.kubernetesingress.ingressendpoint.hostname=" + data.values.application.nodeSelector.hostname

logs:
  general:
    level: DEBUG
  access:
    enabled: true

globalArguments: []
