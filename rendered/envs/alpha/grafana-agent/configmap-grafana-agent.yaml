apiVersion: v1
data:
  config.river: |-
    logging {
      level = "info"
      format = "logfmt"
    }
    discovery.kubernetes "pods" {
      role = "pod"
    }
    discovery.kubernetes "nodes" {
      role = "node"
    }
    prometheus.remote_write "grafana_cloud" {
      endpoint {
        url = env("GC_PROM_URL")

        basic_auth {
          username = env("GC_PROM_USERNAME")
          password = env("GC_PROM_PASSWORD")
        }
      }
    }
    prometheus.scrape "pods" {
      targets    = discovery.kubernetes.pods.targets
      forward_to = [prometheus.remote_write.grafana_cloud.receiver]
    }
    prometheus.scrape "nodes" {
      targets    = discovery.kubernetes.nodes.targets
      forward_to = [prometheus.remote_write.grafana_cloud.receiver]
    }
kind: ConfigMap
metadata:
  annotations:
    a8r.io/repository: https://github.com/Zebradil/myks-homelab
  labels:
    app.kubernetes.io/instance: grafana-agent
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: grafana-agent
    app.kubernetes.io/version: v0.40.3
    helm.sh/chart: grafana-agent-0.37.0
  name: grafana-agent
