apiVersion: v1
data:
  telegram.tmpl: "{{- define \"telegram.severity\" -}}\n{{- if eq . \"critical\" -}}\n\U0001F6A8 CRITICAL\n{{- else if eq . \"warning\" -}}\n⚠️ WARNING\n{{- else if eq . \"info\" -}}\nℹ️ INFO\n{{- else -}}\n\U0001F514 ALERT\n{{- end -}}\n{{- end -}}\n\n{{- define \"telegram.common\" -}}\n{{- with .CommonLabels -}}\n<b>{{ .alertgroup }}/{{ .alertname }}</b>\n{{- with .namespace }}\n<b>Namespace:</b> <i>{{ . }}</i>{{- end }}\n{{- with .pod }}\n<b>Pod:</b> <i>{{ . }}</i>{{- end }}\n{{- with .node }}\n<b>Node:</b> <i>{{ . }}</i>{{- end }}\n{{- with .container }}\n<b>Container:</b> <i>{{ . }}</i>{{- end }}\n{{- end -}}\n{{- with .CommonAnnotations }}\n{{- with .summary }}\n<b>Summary:</b> {{ . | html }}{{- end }}\n{{- with .description }}\n<b>Description:</b> {{ . | html }}{{- end }}\n{{- with .runbook_url }}\n<a href=\"{{ . }}\">Runbook</a>{{- end }}\n{{- end -}}\n{{- end -}}\n\n{{- define \"telegram.alert_list.firing\" -}}\n{{- range .Alerts.Firing }}\n-\n{{- with $.CommonAnnotations.summary }}{{ else with .Annotations.summary }}\n<b>Sum:</b> {{ . | html }}{{ end }}\n{{- with $.CommonAnnotations.description }}{{ else with .Annotations.description }}\n<b>Description:</b> {{ . | html }}{{ end }}\n{{- with $.CommonLabels.pod }}{{ else with .Labels.pod }}\n<b>Pod:</b> <i>{{ . }}</i>{{ end }}\n{{- with $.CommonLabels.container }}{{ else with .Labels.container }}\n<b>Container:</b> <i>{{ . }}</i>{{ end }}\n{{- with $.CommonLabels.node }}{{ else with .Labels.node }}\n<b>Node:</b> <i>{{ . }}</i>{{ end }}\n{{- with .StartsAt }}\n<b>Started at:</b> <i>{{ tz \"Europe/Berlin\" . }} ({{ since . }})</i>{{ end }}\n\n{{- with .GeneratorURL }}\n<a href=\"{{ . | html }}\">Source</a>{{ end }}\n{{- with $.CommonAnnotations.runbook_url }}{{ else with .Annotations.runbook_url }}\n<a href=\"{{ . | html }}\">Runbook</a>{{ end }}{{ end }}\n{{- end -}}\n\n{{- define \"telegram.alert_list.resolved\" -}}\n{{- range .Alerts.Resolved }}\n-\n{{- with $.CommonAnnotations.summary }}{{ else with .Annotations.summary }}\n<b>Sum:</b> {{ . | html }}{{ end }}\n{{- with $.CommonAnnotations.description }}{{ else with .Annotations.description }}\n<b>Description:</b> {{ . | html }}{{ end }}\n{{- with $.CommonLabels.pod }}{{ else with .Labels.pod }}\n<b>Pod:</b> <i>{{ . }}</i>{{ end }}\n{{- with $.CommonLabels.container }}{{ else with .Labels.container }}\n<b>Container:</b> <i>{{ . }}</i>{{ end }}\n{{- with $.CommonLabels.node }}{{ else with .Labels.node }}\n<b>Node:</b> <i>{{ . }}</i>{{ end }}\n{{- with .StartsAt }}\n<b>Started at:</b> <i>{{ tz \"Europe/Berlin\" . }} ({{ . | since | humanizeDuration }})</i>{{ end }}\n\n{{- with .GeneratorURL }}\n<a href=\"{{ . | html }}\">Source</a>{{ end }}\n{{- with $.CommonAnnotations.runbook_url }}{{ else with .Annotations.runbook_url }}\n<a href=\"{{ . | html }}\">Runbook</a>{{ end }}{{ end }}\n{{- end -}}\n\n{{- define \"telegram.message\" }}\n{{- template \"telegram.severity\" .CommonLabels.severity }}: {{ template \"telegram.common\" . }}\n\n{{- if gt (len .Alerts.Firing) 0 }}\n\n\U0001F525 Alerts Firing{{ template \"telegram.alert_list.firing\" . }}{{ end -}}\n\n{{- if gt (len .Alerts.Resolved) 0 }}\n\n✅ Alerts Resolved{{ template \"telegram.alert_list.resolved\" . }}{{ end }}\n\n<a href=\"{{ .ExternalURL | html }}\">Alertmanager UI</a>{{- end -}}"
kind: ConfigMap
metadata:
  annotations:
    a8r.io/repository: https://github.com/Zebradil/myks-homelab
  labels:
    app.kubernetes.io/component: victoria-metrics-k8s-stack-alertmanager
    app.kubernetes.io/instance: vmks
    app.kubernetes.io/name: victoria-metrics-k8s-stack
  name: vmalertmanager-vmks-extra-tpl
  namespace: vmks
