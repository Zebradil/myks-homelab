apiVersion: v1
data:
  telegram.tmpl: "{{- define \"telegram.severity\" -}}\n{{- if eq . \"critical\" -}}\n\U0001F6A8 CRITICAL\n{{- else if eq . \"warning\" -}}\n⚠️ WARNING\n{{- else if eq . \"info\" -}}\nℹ️ INFO\n{{- else -}}\n\U0001F514 ALERT\n{{- end -}}\n{{- end -}}\n\n{{- define \"telegram.common\" -}}\n{{- template \"telegram.severity\" .Data.CommonLabels.severity -}}\n{{- with .Data.CommonLabels -}}\n<b>{{- .alertgroup | html }}/{{ .alertname | html }}</b>\nin namespace <i>{{ .namespace | html }}</i>\n{{- end -}}\n{{- end -}}\n\n{{- define \"telegram.alert_list\" -}}\n{{- template \"telegram.common\" $ -}}\n{{- range . -}}\n---\n{{- with .Annotations.summary }}\n<b>Sum:</b> {{ . | html }}{{ end }}\n{{- with .Labels.pod }}\n<b>Pod:</b> <i>{{ . | html }}</i>{{ end }}\n{{- with .Labels.container }}\n<b>Container:</b> <i>{{ . | html }}</i>{{ end }}\n{{- with .Labels.node }}\n<b>Node:</b> <i>{{ . | html }}</i>{{ end }}\n{{- with .StartsAt }}\n<b>Started at:</b> <i>{{ . | html }}</i>{{ end }}\n{{- with .EndsAt }}\n<b>Ended at:</b> <i>{{ . | html }}</i>{{ end }}\n\n{{- with .GeneratorURL }}\n<a href=\"{{ .GeneratorURL }}\">Source</a>{{ end }}\n{{- with .Annotations.runbook_url }}\n<a href=\"{{ . }}\">Runbook</a>{{ end }}{{ end }}\n{{- end -}}\n\n{{- define \"telegram.message\" }}\n{{- if gt (len .Alerts.Firing) 0 -}}\n\U0001F525 Alerts Firing\n{{ template \"telegram.alert_list\" .Alerts.Firing }}{{ end }}\n{{- if gt (len .Alerts.Resolved) 0 -}}\n✅ Alerts Resolved\n{{ template \"telegram.alert_list\" .Alerts.Resolved }}{{ end }}\n<a href=\"{{ .ExternalURL }}\">Alertmanager UI</a>\n{{- end -}}"
kind: ConfigMap
metadata:
  annotations:
    a8r.io/repository: https://github.com/Zebradil/myks-homelab
  labels:
    app.kubernetes.io/component: victoria-metrics-k8s-stack-alertmanager
    app.kubernetes.io/instance: vmks
    app.kubernetes.io/name: victoria-metrics-k8s-stack
  name: vmalertmanager-vmks-extra-tpl
  namespace: vmks
