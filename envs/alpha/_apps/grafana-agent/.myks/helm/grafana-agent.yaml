agent:
  configMap:
    content: |-
      logging {
        level = "info"
        format = "logfmt"
      }
      discovery.kubernetes "pods" {
        role = "pod"
      }
      discovery.kubernetes "nodes" {
        role = "node"
      }
      prometheus.remote_write "grafana_cloud" {
        endpoint {
          url = env("GC_PROM_URL")

          basic_auth {
            username = env("GC_PROM_USERNAME")
            password = env("GC_PROM_PASSWORD")
          }
        }
      }
      prometheus.scrape "pods" {
        targets    = discovery.kubernetes.pods.targets
        forward_to = [prometheus.remote_write.grafana_cloud.receiver]
      }
      prometheus.scrape "nodes" {
        targets    = discovery.kubernetes.nodes.targets
        forward_to = [prometheus.remote_write.grafana_cloud.receiver]
      }
  envFrom:
  - secretRef:
      name: grafana-cloud-endpoints
