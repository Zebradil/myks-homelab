#@ load("@ytt:struct", "struct")

#@ def gen_protected_ingress_route(name, hosts):
#@   matches = []
#@   for host in hosts:
#@     matches.append("Host(`{}.{}`)".format(name, host))
#@   end
apiVersion: traefik.io/v1alpha1
kind: IngressRoute
metadata:
  name: #@ name
spec:
  routes:
    - match: #@ " || ".join(matches)
      kind: Rule
      middlewares:
        - name: chain-authelia-auth
          namespace: authelia
      services:
        - name: #@ name
          port: http
#@ end

#@ route = struct.make(protected=gen_protected_ingress_route)
